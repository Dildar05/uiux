# Лабораторная №8 — Accessibility Audit (на основе проекта из `desktop`)

Эта папка содержит интерактивную страницу аудита, которая анализирует цвета и типографику, взятые из файла `desktop/css/desktop-styles.css` вашего проекта.

Файлы в этой папке:

- `accessibility-audit.html` — интерактивная страница аудита (контраст, типографика, симуляция дальтонизма, переключатель темы «обычная / контрастная»).
- `styles.css` — CSS стили для страницы аудита.
- `script.js` — JS: функции для расчёта контраста, генерации таблицы «до/после» и экспорта CSV.
- `contrast-table.csv` — (пустой) пример таблицы, можно скачать с страницы после расчёта.

Как использовать

1. Откройте `Lab 8/accessibility-audit.html` в браузере (двойной клик) или запустите локальный сервер в этой папке и откройте http://localhost:8000/accessibility-audit.html.

2. Нажмите «Вычислить контраст», чтобы собрать таблицу. Можно менять hex‑значения в полях "Foreground" и "Background" и повторно нажимать кнопку.

3. Переключатель "High-contrast theme" применяет предложенные альтернативные цвета (параметры `--primary-a11y` и т.п.).

4. Включите симуляцию протанопии/деутеранопии/тританопии для быстрых визуальных проверок.

Вопросы / варианты дальнейшей работы

- Хотите, чтобы я сгенерировал «до/после» (предложил новые hex‑цвета) автоматически и добавил их в таблицу? (Да/Нет)
- Хотите, чтобы я запустил локальный HTTP‑сервер и проверил страницу сейчас, а затем сделал скриншоты симуляций? (Да/Нет)
- Хотите, чтобы предложенные правки автоматически применялись в файлах `desktop/css/desktop-styles.css` (с созданием резервной копии)? (Да/Нет)

Ответьте, пожалуйста, на эти вопросы, и я выполню выбранное действие.

## Проверка типографики проекта `desktop`

Ниже — результаты быстрой проверки утверждений, которые вы просили подтвердить:

- Иерархия (h1 → h3, p) и использование CSS‑переменных для размеров шрифтов:
	- Результат: в файле `desktop/css/desktop-styles.css` нет определённых переменных типа `--font-size-...` и нет явных правил для `h1`, `h2`, `h3`, `p` с использованием таких переменных.
	- Вывод: утверждение "Все тексты используют переменные CSS (var(--font-size-...))" не подтверждается для текущего файла `desktop/css/desktop-styles.css`.

- Межстрочный интервал (line-height для основного текста = 1.5):
	- Результат: в `desktop/css/desktop-styles.css` не найдено глобального правила `line-height: 1.5` для body или явного правила для параграфов; следовательно, нельзя подтвердить, что в проекте используется именно 1.5.
	- Примечание: в файле аудита `Lab 8/accessibility-audit.html` в CSS‑фрагменте типографической шкалы задано `line-height: 1.5` для `.body` — это часть audit UI, а не текущих стилей проекта `desktop`.

- Длина строки (max-width: 65ch для параграфов):
	- Результат: в `desktop/css/desktop-styles.css` есть правило `.desktop-content-wrapper { max-width: 1400px; }`, но правило `max-width: 65ch` для параграфов или общего контейнера не найдено.
	- Вывод: ограничение `max-width: 65ch` в проекте не обнаружено.

Краткие рекомендации

- Если хотите обеспечить консистентную типографику и легко проверяемую иерархию, предлагаю в `desktop/css/desktop-styles.css` добавить набор переменных и базовых правил, например:

	:root {
		--font-family-sans: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
		--font-size-display: 48px;
		--font-size-h1: 32px;
		--font-size-h2: 24px;
		--font-size-body: 16px;
		--font-size-caption: 12px;
		--line-height-body: 1.5;
		--max-text-width: 65ch;
	}

	И затем использовать их в селекторах `h1, h2, h3, p` и в контейнере контента. Это упростит проверку и применение правок в будущем.

- Я могу автоматически предложить/вставить эти переменные и соответствующие правила в `desktop/css/desktop-styles.css` (с созданием резервной копии), если вы подтвердите — скажите "Да, внеси предложения в файл".

Если нужно, я также сформирую патч с минимальными изменениями в `desktop/css/desktop-styles.css` и дам краткий отчёт о том, что изменено и почему.

## Детальный отчёт: симуляция дальтонизма, состояния, A11y‑палитра и сравнение "До / После"

Я добавил интерактивную секцию на странице `accessibility-audit.html`, которая выполняет следующие проверки и действия:

- Симуляции дальтонизма: Protanopia / Deuteranopia / Tritanopia — визуальная фильтрация превью и программная проверка контрастов после трансформации цветов.
- Проверка состояний: Hover / Pressed / Disabled для кнопок (в светлой и тёмной темах) — рассчитывается контраст текста на фоне в каждом состоянии.
- Генерация Brand / A11y варианта палитры (предложение альтернатив) и возможность применить эти переменные к секции "After" (локально, в превью, без изменения исходных файлов).
- Before / After: два макета-превью (простая имитация sidebar/header/content) показывают визуально результат до и после применения A11y‑палитры.

Ниже — конкретные замены, которые предлагаются скриптом и краткое объяснение каждой из них (основано на исходных значениях из `desktop/css/desktop-styles.css`):

1) Primary
	- Оригинал: `--primary: #15803d`
	- Предложение (Brand / A11y): `--brand-a11y: #0f5130` → используется как `--primary` в A11y‑варианте.
	- Почему: более тёмный оттенок зелёного увеличивает контраст текста (особенно белого) и кнопок на светлом фоне; улучшает соотношение яркости для слабовидящих.

2) Primary light
	- Оригинал: `--primary-light: #22c55e`
	- Предложение: затемнить до близкого оттенка (`#15803d` / `#17643a`) или использовать скомпенсированный `--primary` для градиентов.
	- Почему: яркий светлый шаг в градиенте иногда даёт низкий контраст текста на цветных фоновых элементах; более плотный градиент даёт лучшую читаемость.

3) Secondary
	- Оригинал: `--secondary: #84cc16`
	- Предложение: слегка затемнить (`#5f8d0f`) или выбрать другой контрастный оттенок для статусов/индикаторов.
	- Почему: текущий лаймовый цвет может не проходить требование 4.5:1 на светлом фоне для некоторых сочетаний.

4) Тексты
	- Оригинал: `--text: #374151`, `--text-light: #6b7280`
	- Предложение: увеличить контраст основного текста до `#111827` (для текста на белом фоне) и сместить `--text-light` к `#4b5563` для читаемости меток.
	- Почему: более тёмный основной текст даёт уверенный запас контраста на белых карточках; приглушённые метки остаются различимыми.

5) Границы и панели
	- Оригинал: `--border: #e5e7eb`, `--sidebar-bg: #334155`
	- Предложение: для границ выбрать `#cbd5e1` или более контрастный тон; для сайдбара — сохранить `#334155`, но гарантировать белый текст (`#ffffff`) поверх (контраст ≥ 4.5).

Как были сделаны проверки (коротко, технически)

- Для каждой пары foreground/background вычисляется текущий contrast ratio (WCAG). Если пара не проходит (для normal text ≥4.5, для large ≥3), скрипт предлагает замену:
	- сначала использует явную подсказку (например, `--brand-a11y`), если она задана;
	- иначе пробует смешать foreground в сторону чёрного (и затем — в сторону белого) по шагам, пока не найдёт ближайший цвет, удовлетворяющий требованию.
- Симуляции дальтонизма выполняются программно над hex‑цветом через матрицы преобразования (protan/deutan/tritan) — затем для трансформированных цветов считается контраст; это даёт числовые метрики, которые показывают, какие пары могут стать менее различимы при конкретном типе дальтонизма.
- Состояния hover/pressed/disabled моделируются просто:
	- hover: background затемняется ~8%
	- pressed: background затемняется ~18%
	- disabled: foreground смешивается с фоном (~60%)
	и затем для каждого состояния рассчитывается контраст.

Что изменил на странице

- В `accessibility-audit.html` добавлена секция "Детальная проверка" с кнопками:
	- Run detailed checks — выполняет все проверки и показывает таблицу с метриками (оригинал, protan/deutan/tritan, состояния, рекомендации).
	- Generate Brand / A11y variants — генерирует палитру (скрипт сохраняет её в памяти страницы).
	- Apply A11y to "After" preview — применяет палитру к правому примеру экрана для визуальной оценки (локально, не меняя проектные файлы).
	- Reset previews — сбрасывает превью к оригиналу.

Следующие шаги / рекомендации (предлагаю сделать дальше)

- Если вы хотите, я могу автоматически внести согласованные замены в `desktop/css/desktop-styles.css` и создать резервную копию (например, `desktop/css/desktop-styles.css.bak`) — скажите "Да, внеси изменения".
- Я могу сгенерировать скриншоты Before/After (включая симуляции дальтонизма) если вы запустите локальный HTTP‑сервер и подтвердите — тогда я запущу страницу и сниму PNG (требуется локальный сервер).
- Если вам нужно полное перечисление всех найденных пар, которые не прошли — нажмите "Вычислить контраст" и затем "Run detailed checks" на странице, экспортируйте CSV и пришлите его — я подготовлю патч с точечными заменами.

Если хотите, сейчас могу автоматически применить предложенные замены в `desktop/css/desktop-styles.css` (с резервной копией), либо только сгенерировать патч для вашего ревью. Напишите, какой вариант предпочитаете.
